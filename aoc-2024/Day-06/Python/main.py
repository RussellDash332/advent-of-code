S=list.__setitem__;r=len(m:=[*map(list,open(X:=0))]);c=len(m[-1]);R=range;[[z:=0,[(T:=m[a])[b]=='^.'[p]and[f:=[*(X:=X or(a,b))],i:=f[0],j:=f[1],S(T,b,'^#'[p]),d:={0},x:=-1,y:=0,l:=0,[(r>i>-1<j<c)*(2-p-l)and[w:=(i,j),[[u:=y,y:=-x,x:=u]for _ in'.'*4if r>i+x>-1<j+y<c!=m[i+x][j+y]<'.'],i:=i+x,j:=j+y,t:=w+(i,j)*p,l:=l|(t in d),d.add(t)]for _ in'.'*r*c],S(T,b,'^.'[p]),z:=z+[len(d)-1,l][p]]for a in R(r)for b in R(c)],print(f'Part {p+1}:',z)]for p in(0,1)]